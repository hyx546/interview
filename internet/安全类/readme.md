# 安全类

## CSRF 跨站请求伪造

引诱用户进入第三方网站，向被攻击网站发送跨站请求，利用用户在被攻击网站的登录状态cookie，绕过后台的用户验证，达到伪造用户对被攻击网站执行不安全操作

### 攻击原理

`在已经登录的状态`，利用同源请求下，会自动携带cookie的原理实现身份伪造；

1. 用户登录网站A，服务器会返回cookie保存在浏览器内存中
2. 通过访问网站B，引诱点击某链接，该链接指向网站A的api接口
3. 请求该api接口时，会自动携带cookie，伪造用户身份进行不安全操作

### 特点

1. 攻击一般发起都在第三方网站，而不在被攻击网站，所以被攻击网站无法阻止
2. 攻击利用的是用户登录态的验证凭证，伪造身份，而不是直接窃取信息
3. 整个过程并不能获取到cookie，仅仅是伪造

### 防御手段

- Referer验证 （同源验证）
原理：通过Referer 验证页面来源，即页面来源必须是该站点下的域名
缺点：把安全性依赖于第三方（浏览器），并不能保证浏览器自身没有安全漏洞

- CSRF的Token验证 （验证码和密码也是利用了token的原理）
原理：发起请求时，通过将token放入请求头/参数中，服务端通过验证token，来识辨是否是用户发起的请求
缺点：只要页面没有XSS泄漏透露token，那么csrf就无法攻击

- 双重cookie
原理： 通过将token放入cookie中，然后请求时取出cookie中的token作为请求参数，服务器校验cookie中的token和url中的token是否一致
缺点：跨域会存在请求无法获取cookie

## XSS 跨站脚本攻击

通过向网站中注入一段恶意js脚本，引诱用户进行点击

### 攻击原理

恶意代码未经过滤，使其与页面正常代码混在一起，浏览器无法进行分辨

### 反射型xss攻击

1. 攻击者构造特殊的URL，其中包含恶意代码
2. 服务端将url取出，返回给浏览器
3. 浏览器解析并执行恶意代码
4. 恶意代码窃取用户信息/冒充用户行为

### 存储型xss攻击

1. 攻击者将恶意代码提交到目标网站的数据库
2. 用户打开目标网站，服务器会将恶意代码从数据库中取出，返回给浏览器
3. 浏览器解析并执行恶意代码
4. 恶意代码窃取用户信息/冒充用户行为

### Dom型xss攻击

1. 攻击者构造出特殊的URL，其中包含恶意代码
2. 用户打开带有恶意代码的url，服务器会将恶意代码从数据库中取出，返回给浏览器
3. 浏览器解析并执行恶意代码，js取出url的恶意代码并执行

[注意区别]：dom和前两种xss攻击的区别在于，前两种攻击是发生在服务器的安全漏洞，而Dom型是由浏览器完成，属于前端js自身的漏洞

### XSS的攻击防御

两个策略

1. 攻击者提交恶意代码
2. 浏览器执行恶意代码

前者可以进行输入过滤，对于数字，邮箱，电话号码等特殊类型

#### 浏览器执行恶意代码

1. 改为纯前端渲染，把数据和代码分隔开
2. 对html进行充分转义
